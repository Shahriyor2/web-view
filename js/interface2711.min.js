var ie = $.browser.msie;
var ie9 = ie && $.browser.version <= 9;
var ie11 = !!navigator.userAgent.match(/Trident\/7\./);
var PROJECT = window.PROJECT || {};
var PROJECT_ = {};
$().ready(function () {
  jQuery.ajaxSetup({ headers: { "X-Csrf-Token": token_ } });
  PROJECT_ = { $body: $("body"), $viewport: $(window) };
  $('[data-toggle="tooltip"]').tooltip();
  $(".nav-main,.footer")
    .find("a")
    .on("click", function () {
      var e = $(this);
      var f = e.attr("href").substr(1);
      e.blur();
      scroll_to(f);
      return false;
    });
  PROJECT.customFormElemens();
  PROJECT.parallax();
  PROJECT.animations();
  if (device.mobile()) {
    $('[data-input-type="number"]').attr("type", "number");
  }
  function a(f, g, e, h) {
    $.ajax({
      url: ctx_ + "/index_ajax.htm",
      type: "POST",
      dataType: "json",
      data: { card: f },
      success: function (i, j) {
        $.each(i, function (k, l) {
          if (k == "url" && l != "-1") {
            $(e).attr("src", l);
            $(g).show();
          } else {
            if (k == "kazkom" && l != "-1") {
              $(h).val(l);
            }
          }
        });
        d();
      },
      error: function (i, k, j) {},
    });
  }
  function d() {
    var j = $("#sender_bank").val();
    var g = $("#receiver_bank").val();
    var h = $("#amount").val();
    if (h > 0 && (j == "0" || j == "1") && (g == "0" || g == "1")) {
      var i = "";
      if (j == "1" && g == "1") {
        i = "95 KZT";
      } else {
        if (j == "0" && g == "1") {
          i = "0 KZT";
        } else {
          if (j == "1" && g == "0") {
            var f = (h / 100) * 0.9;
            if (f < 150) {
              f = 150;
            } else {
              if (f > 750) {
                f = 750;
              } else {
                f = c(f, 2);
              }
            }
            i = f + " KZT";
          } else {
            if (j == "0" && g == "0") {
              var e = (h / 100) * 0.9;
              if (e < 250) {
                e = 250;
              } else {
                if (e > 750) {
                  e = 750;
                } else {
                  e = c(e, 2);
                }
              }
              i = e + " KZT";
            }
          }
        }
      }
      $("#p2p_comm").text(i);
      $("#commission").show();
    }
  }
  $("#amount").keyup(function () {
    d();
  });
  function c(g, f) {
    var e = Math.pow(10, f);
    return Math.round(g * e) / e;
  }
  $("#sender_card_num").keyup(function () {
    var e = "" + $("#sender_card_num").val().replace(/ /g, "");
    if (e.length == 6) {
      a(e, "#sender_bank", "#sender_bank_logo", "#sender_bank");
    } else {
      if (e.length < 6) {
        $("#sender_bank").hide();
        $("#sender_bank_logo").attr("src", "");
      }
    }
  });
  $("#receiver_card_num").keyup(function () {
    var e = "" + $("#receiver_card_num").val().replace(/ /g, "");
    if (e.length == 6) {
      a(e, "#receiver_bank", "#receiver_bank_logo", "#receiver_bank");
    } else {
      if (e.length < 6) {
        $("#receiver_bank").hide();
        $("#receiver_bank_logo").attr("src", "");
      }
    }
  });
  var b = function (m) {
    var f = false,
      n = m.replace(/ +/g, "").replace(/-+/g, "");
    var e = n.length;
    if (e >= 14 && e <= 16 && parseInt(n) > 0) {
      var k = 1;
      var g = "";
      for (var h = e - 1; h >= 0; h--) {
        var l = parseInt(n.charAt(h));
        g += k++ % 2 == 0 ? l * 2 : l;
      }
      var j = 0;
      for (var h = 0; h < g.length; h++) {
        j += parseInt(g.charAt(h));
      }
      f = j % 10 == 0;
    }
    return f;
  };
  $("#transfer_form").validate({
    rules: {
      sender_card_num: { required: true },
      sender_cvv: { required: true },
      amount: { required: true },
      receiver_card_num: { required: true },
      sender_email: { email: true },
    },
    submitHandler: function (g) {
      var e = "" + $("#sender_card_num").val().replace(/ /g, "");
      if (b(e)) {
        var f = "" + $("#receiver_card_num").val().replace(/ /g, "");
        if (b(f)) {
          g.submit();
        } else {
          $("#receiver_card_num").addClass("error");
          $("#receiver_init_message").hide();
          $("#receiver_init_err_message").show();
        }
      } else {
        $("#sender_card_num").addClass("error");
        $("#sender_init_message").hide();
        $("#sender_init_err_message").show();
      }
    },
    errorElement: "label",
    wrapper: "div",
    success: function (e, f) {
      $("#sender_init_err_message").hide();
      $("#sender_init_message").show();
      $("#receiver_init_err_message").hide();
      $("#receiver_init_message").show();
    },
    errorPlacement: function (e, f) {},
  });
});
function scroll_to(b) {
  var a = $("#" + b);
  var c = a.offset().top;
  $("html,body").animate({ scrollTop: c }, 800);
}
PROJECT.customFormElemens = function () {
  $("select").selectpicker({ style: "form-control" });
};
PROJECT.parallax = function () {
  $("[data-speed]").each(function () {
    var a = $(this);
    var c = a.parents(".block-in");
    var b = parseFloat(a.attr("data-speed"), 10);
    PROJECT_.$viewport.on("scroll", function () {
      var h = c.offset().top;
      var e = c.height();
      var f = $(this).width();
      var d = $(this).scrollTop() + $(this).height();
      var j = ((d - h) * 100) / e;
      var i = (100 - j) / b;
      if (j > 100 || f <= 750) {
        i = 0;
      }
      var g =
        "-moz-transform: translateY(-" +
        i +
        "%);-ms-transform: translateY(-" +
        i +
        "%);-webkit-transform: translateY(-" +
        i +
        "%);transform: translateY(-" +
        i +
        "%);";
      a.attr("style", g);
    });
  });
};
PROJECT.animations = function () {
  if (device.mobile()) {
    return false;
  }
  var a = " animated";
  $("[data-animation-in-down],[data-animation-in-up]").each(function () {
    var b = $(this);
    var c = { up: b.attr("data-animation-in-up"), down: b.attr("data-animation-in-down") };
    var d = { up: b.attr("data-animation-out-up"), down: b.attr("data-animation-out-down") };
    var e = new Waypoint.Inview({
      element: b[0],
      enter: function (f) {},
      entered: function (f) {
        if (f == "down") {
          b.addClass(c.up + a);
        } else {
          b.addClass(c.down + a);
        }
      },
      exit: function (f) {
        if (f == "down") {
          if (typeof d.up != "undefined" && d.up != "") {
            b.removeClass(c.up + " " + c.down + a);
            b.addClass(d.up + a);
          }
        } else {
        }
      },
      exited: function (f) {
        b.removeClass(c.up + " " + c.down + " " + d.up + " " + d.down + a);
      },
    });
  });
  $("[data-animation-in]").each(function () {
    var b = $(this);
    var c = b.attr("data-animation-in");
    var d = b.attr("data-animation-out");
    var e = new Waypoint.Inview({
      element: b[0],
      enter: function (f) {},
      entered: function (f) {
        b.addClass(c + a);
      },
      exit: function (f) {
        if (typeof d != "undefined" && d != "") {
          b.removeClass(c + a);
          b.addClass(d + a);
        }
      },
      exited: function (f) {
        b.removeClass(c + " " + d + a);
      },
    });
  });
};
